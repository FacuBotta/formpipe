# `@formpipe/contact-form`

A robust and flexible solution for handling contact form submissions and sending emails, designed for static sites. This package provides a TypeScript library for frontend integration and a CLI tool to generate a PHP backend for email processing.

## Features

*   **Frontend Validation**: Integrates with `@formpipe/validators` for comprehensive form input validation.
*   **CLI Configuration**: Easily set up and generate your PHP email backend.
*   **PHP Email Backend**: Securely sends emails using PHPMailer, supporting SMTP, rate limiting, and confirmation emails.
*   **CORS Support**: Configurable for seamless integration with your frontend.

## Installation

To install the package, use npm:

```bash
npm install @formpipe/contact-form
```

## Usage

### 1. Initialize Configuration

First, use the `formpipe` CLI to create a `formpipe.config.json` file in your project root. This file will store your email sending and form validation settings.

```bash
npx formpipe init
```

This command will guide you through setting up your SMTP server details, recipient email, and form fields with their validation rules.

### 2. Generate PHP Backend

After configuring `formpipe.config.json`, generate the `contact-form.php` file. This PHP script will handle incoming form submissions and send emails.

```bash
npx formpipe generate
```

This command will create a `contact-form.php` file (by default in your project root, or as configured in `formpipe.config.json`).

### 3. Deploy the PHP Backend

Deploy the generated `contact-form.php` file to your web server. This file will act as the endpoint for your contact form submissions. Ensure your web server (e.g., Apache, Nginx) is configured to execute PHP files.

**Example Apache Configuration (if using `.htaccess`):

```apache
# .htaccess example (ensure PHP is enabled)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteRule ^contact-form.php$ contact-form.php [L]
</IfModule>
```

### 4. Integrate with Your Frontend

Use the `@formpipe/contact-form` library in your frontend application to submit form data to your deployed `contact-form.php` endpoint.

```typescript
import { ContactForm } from '@formpipe/contact-form';

// Initialize ContactForm with the URL of your deployed PHP backend
const contactForm = new ContactForm('https://your-domain.com/contact-form.php');

async function handleSubmit(event: Event) {
  event.preventDefault();

  const formData = new FormData(event.target as HTMLFormElement);
  const data = Object.fromEntries(formData.entries());

  try {
    const response = await contactForm.submit({
      replyTo: data.email as string,
      fields: [
        { key: 'name', value: data.name as string },
        { key: 'message', value: data.message as string },
      ],
    });

    if (response.success) {
      alert('Message sent successfully!');
      // Clear form or show success message
    } else {
      alert('Failed to send message: ' + response.error);
      // Display validation errors or general error
      if (response.errors) {
        console.error('Validation errors:', response.errors);
      }
    }
  } catch (error) {
    console.error('Submission error:', error);
    alert('An unexpected error occurred.');
  }
}

// Attach handleSubmit to your form's submit event
// document.getElementById('your-form-id')?.addEventListener('submit', handleSubmit);
```

## Configuration (`formpipe.config.json`)

The `formpipe.config.json` file, generated by `npx formpipe init`, allows you to customize:

*   **`smtp`**: Your SMTP server details (host, port, username, password).
*   **`to`**: The recipient email address for form submissions.
*   **`from`**: The sender email address for outgoing emails.
*   **`rateLimit`**: The maximum number of submissions allowed per minute from a single `replyTo` email address.
*   **`rules`**: Define validation rules (e.g., `required`, `minLength`, `maxLength`, `isEmail`) for each of your form fields.
*   **`sendConfirmation`**: (Optional) Configure sending a confirmation email to the sender after a successful submission.

For detailed configuration options, refer to the comments within the generated `formpipe.config.json` file.
